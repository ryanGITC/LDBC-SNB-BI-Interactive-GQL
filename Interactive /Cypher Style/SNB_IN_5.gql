
CREATE QUERY know_VIEW as (
MATCH (p:Person { id: $personId })-[:KNOWS]-(f: friend) {1,2}
WHERE
     person <> f
Return DISTINCT f
)

CREATE QUERY forum_VIEW AS (
FROM know_VIEW
MATCH (f)<-[m:HAS_MEMBER]-(forum)
WHERE
    m.joinDate > $minDate

AND know_VIEW.f.id == f.id
RETURN
    forum,
    COLLECT(f) AS friends
)


FROM know_VIEW,forum_VIEW
OPTIONAL MATCH (f)<-[:HAS_CREATOR]-(post)<-[:CONTAINER_OF]-(forum)
WHERE
    f IN friends
RETURN
    f.id as person
    forum.title AS nameForum,
    count(post) AS countPost
ORDER BY
    postCount DESC,
    forum.id ASC
LIMIT 20
